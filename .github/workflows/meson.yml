name: Meson

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

env:
  # Customize the Meson build type here (release, debug)
  BUILD_TYPE: release

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # Checkout the repository including submodules
      - uses: actions/checkout@v4
        with:
          submodules: true  # Ensure submodules are initialized

      # Install Meson and other dependencies
      - name: Install Meson
        run: sudo apt-get install -y meson ninja-build openmpi-bin libopenmpi-dev

      # Configure Meson, ensuring that the build is set up correctly
      - name: Configure Meson
        run: meson setup ${{github.workspace}}/builddir --buildtype=${{env.BUILD_TYPE}}

      # Compile the project
      - name: Build
        working-directory: ${{github.workspace}}/builddir
        run: meson compile

      # Run tests (if applicable)
      - name: Test
        working-directory: ${{github.workspace}}/builddir
        run: meson test
